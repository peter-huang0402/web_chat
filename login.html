<!DOCTYPE html>
<style>
* {
  box-sizing: border-box;
}

.wrap {
  margin: 0 auto;
  width: 500px;
}

h2 {
  text-align: center;
  color: #25a6af;
}

.name,
.password {
  margin-bottom: 5px;
  width: 500px;
  height: 40px;
  padding: 10px;
  border-radius: 10px;
  border: 1px solid #333;
}

label {
  padding-right: 10px;
}

input {
  margin-top: 10px;
}

input:focus {
  outline: none;  
}

#btn {
  text-align: center;
}

#btn input {
  width: 45%;
  margin: 2%;
  margin-top: 10px;
  border: none;
  height: auto;
  padding: 5px;
  font-size: 16px;
  border-radius: 100px;
}

.register,
.logIn {
  cursor: pointer;
}

.register {
  background-color: #06a81c;
  color: #fff;
}

.register:hover {
  background-color: #047714;
  color: #fff;
}

.logIn {
  background-color: #ffce49;
  color: #816516;
}

.logIn:hover {
  background-color: #ffc31f;
  color: #816516;
}

</style>

<html>
<body>

 <div class="wrap">
    <h2>Web Chat Room</h2>
    <form action="form.html">
      <label for="name">Name:</label>
      <input id="name" type="text" name="name" class="name" placeholder="Key in your name"><br>

      <label for="password">Password:</label>
      <input id="password" type="password" name="password" class="password" placeholder="Key in your password"> <br>
      
      <div id="email_div" style='display:none' > 
      <label for="name">Email: (For registeration only.)</label>
      <input id="email" type="email" name="email" class="name" placeholder="Key in your email"><br> 
      </div>

      <div id="btn">        
        <input  id="login" type="button" value="Login" class="login">
	<input  id="register" type="button" value="Register" class="register">
      </div>
  </div>
  </form>
 <p id="message"></p> 

</body>
</html>

 <script src="https://code.jquery.com/jquery-3.3.1.min.js" crossorigin="anonymous"></script>

<script type="text/javascript"> 
var registerBtn = document.querySelector('.register');
var logInBtn = document.querySelector('.login');
// var msg = document.getElementById('message');


/*
  url: 'http://localhost:3030/users',
    json: true,
    body: {
        username: "Joe" , 
        password : "1234" , 
        email : "Joe@gmail.com"        
    }
*/


function registerAction() {   
  
   //alert(document.getElementById('email_div').style.display );
 
  var emailDiv = document.getElementById('email_div');
  if ( emailDiv.style.display == 'none'){
       emailDiv.style.display = 'inline';
       return;
  }


  // model
  var nameStr = document.getElementById('name').value.trim();
  var passwordStr = document.getElementById('password').value.trim();
  var emailStr = document.getElementById('email').value.trim();

  //alert("name="+nameStr+" ,passwordStr="+ passwordStr+  " ,emailStr="+emailStr);

  if (nameStr =='' || passwordStr =='' || emailStr == ''){
      alert("Must have values in name, password and email.");
      return;
  }

  var user = {}; 
  user.username = nameStr; 
  user.password = passwordStr;
  user.email = emailStr;
  


/*
	$.ajax({
                        url: "http://localhost:3030/users",
                        method: "get",                        
                        success: function ( data , textStatus, jQxhr ) {
			    console.log( typeof(data) );
                            //alert('good'+data +" , length="+data.length);                            
	  		    var b = '';
		            for( var a=0;a<data.length;a++){
				 b = data[a];
				 alert(b.id + " ="+  b.username +" , role="+b.role);
			    }

                        },
                        error: function( jQxhr , textStatus , errorThrown ){
                           alert('[ERR] Please try it again. status='+jQxhr.status +" ,textStatus=" + textStatus +" ,errorThrown="+errorThrown );
                           console.log('[ERR] status='+jQxhr.status +" ,textStatus=" + textStatus +" ,errorThrown="+errorThrown );
                        }
                    });
*/

                $.ajax({
                        url: "http://localhost:3030/users",
                        method: "post",
                        //data: { username: "john2" , password : "1234" , role : "admin"},
                        data: user ,
		        dataType: "json",
                        success: function ( data , textStatus, jQxhr ) {                           
//			    document.getElementById('login').disable ='display:';
//                            document.getElementById('register').style ='display:none';
                            document.getElementById('email_div').style ='display:none';

			    console.log( typeof(data) );
                            alert('Register successfully with name='+user.username+' ,id='+data );                            	  		    
                        },
                        
                        error: function( xhr , status , error ){
                           alert('[ERR] Please try it again. status='+xhr.responseText );
                           console.log('[ERR] status='+xhr.responseText +" ,status=" + status +" ,error="+error );
                        }
                       
                    });




}


function logInAction() {

  // model
  var nameStr = document.getElementById('name').value.trim();
  var passwordStr = document.getElementById('password').value.trim();


  if (nameStr =='' || passwordStr =='' ){
      alert("Must have values in name and password.");
      return;
  }

  var user = {}; 
  user.username = nameStr; 
  user.password = passwordStr; 



                $.ajax({
                        url: "http://localhost:3030/users/login",
                        method: "post",
                        //data: { username: "john2" , password : "1234" , role : "admin"},
                        data: user ,
		        dataType: "json",
                        success: function ( data , textStatus, jQxhr ) {                           
			    //document.getElementById('register').style ='display:inline';                            
                            document.getElementById('email_div').style ='display:none';

			    console.log( typeof(data) );
                            alert('Login successfully with name='+user.username );                            	  		   
                            top.location.href = "/go";

                        },
                        
                        error: function( xhr , status , error ){
                           alert('[ERR] Please try it again. status='+xhr.responseText );
                           console.log('[ERR] status='+xhr.responseText +" ,status=" + status +" ,error="+error );
                        }
                       
                    });

}


// event
registerBtn.addEventListener('click', registerAction, false);
logInBtn.addEventListener('click', logInAction, false);

</script>
